<UserControl
    x:Class="EModbus.Views.MasterView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shadui="clr-namespace:ShadUI;assembly=ShadUI"
    xmlns:vm="clr-namespace:EModbus.ViewModels"
    d:DesignHeight="600"
    d:DesignWidth="800"
    x:DataType="vm:MasterViewModel"
    mc:Ignorable="d">
    <StackPanel Spacing="16" Margin="0,16,0,0">
        <!-- 主站状态卡片 -->
        <shadui:Card>
            <shadui:Card.Header>
                <StackPanel Spacing="4">
                    <TextBlock Classes="h3" Text="主站状态" />
                    <TextBlock Classes="Muted" Text="Modbus TCP 主站测试" />
                </StackPanel>
            </shadui:Card.Header>
            <shadui:Card.Content>
                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" Margin="0,8,0,0">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="目标地址" VerticalAlignment="Center" />
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding MasterSettings.IpAddress}" Classes="Muted" />

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="端口号" VerticalAlignment="Center" Margin="0,8,0,0" />
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding MasterSettings.Port}" Classes="Muted" Margin="0,8,0,0" />

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="从站ID" VerticalAlignment="Center" Margin="0,8,0,0" />
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding MasterSettings.SlaveId}" Classes="Muted" Margin="0,8,0,0" />

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="连接状态" VerticalAlignment="Center" Margin="0,8,0,0" />
                    <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                        <TextBlock Text="{Binding MasterStatus}" 
                                   Classes.Success="{Binding IsMasterConnected}"
                                   Classes.Warning="{Binding IsReconnecting}"
                                   Classes.Muted="{Binding !IsMasterConnected}" />
                    </StackPanel>
                </Grid>
            </shadui:Card.Content>
            <shadui:Card.Footer>
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <CheckBox IsChecked="{Binding AutoReconnect}" Content="自动重连" />
                    </StackPanel>
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
                        <Button Content="停止重连" Classes="Outline" 
                                Command="{Binding StopReconnectCommand}" 
                                IsVisible="{Binding IsReconnecting}" />
                        <Button Content="连接" Classes="Primary" 
                                Command="{Binding ConnectMasterCommand}" 
                                IsEnabled="{Binding !IsMasterConnected}" 
                                IsVisible="{Binding !IsReconnecting}" />
                        <Button Content="断开" Classes="Destructive" 
                                Command="{Binding DisconnectMasterCommand}" 
                                IsEnabled="{Binding IsMasterConnected}" />
                    </StackPanel>
                </Grid>
            </shadui:Card.Footer>
        </shadui:Card>

        <!-- 数据类型测试 TabControl -->
        <TabControl>
            <!-- UShort Tab (保持寄存器 + 线圈) -->
            <TabItem Header="UShort">
                <StackPanel Spacing="16" Margin="0,16,0,0">
                    <!-- 保持寄存器读写卡片 -->
                    <shadui:Card>
                        <shadui:Card.Header>
                            <StackPanel Spacing="4">
                                <TextBlock Classes="h3" Text="保持寄存器" />
                                <TextBlock Classes="Muted" Text="读写保持寄存器 (功能码 03/06)" />
                            </StackPanel>
                        </shadui:Card.Header>
                        <shadui:Card.Content>
                            <StackPanel Spacing="16">
                                <StackPanel Spacing="20" Orientation="Horizontal">
                                    <TextBlock Margin="0,0,8,0">轮询寄存器 0 结果：</TextBlock>
                                    <TextBlock Text="{Binding PollyResult}"/>
                                </StackPanel>

                                <!-- 读取 -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto" RowDefinitions="Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="起始地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding ReadAddress}" Watermark="0" />
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="数量" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding ReadCount}" Watermark="10" />
                                    <Button Grid.Row="0" Grid.Column="4" Content="读取" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding ReadHoldingRegistersCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="结果" VerticalAlignment="Center" Margin="0,8,8,0" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" 
                                             Text="{Binding ReadResult}" IsReadOnly="True" 
                                             Watermark="读取结果显示在这里..." Margin="0,8,0,0" />
                                </Grid>

                                <Border Height="1" Background="{DynamicResource BorderBrush}" />

                                <!-- 写入 -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto">
                                    <TextBlock Grid.Column="0" Text="地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Column="1" Text="{Binding WriteAddress}" Watermark="0" />
                                    <TextBlock Grid.Column="2" Text="值" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Column="3" Text="{Binding WriteValue}" Watermark="0" />
                                    <Button Grid.Column="4" Content="写入" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding WriteSingleRegisterCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                </Grid>
                            </StackPanel>
                        </shadui:Card.Content>
                    </shadui:Card>

                    <!-- 线圈读写卡片 -->
                    <shadui:Card>
                        <shadui:Card.Header>
                            <StackPanel Spacing="4">
                                <TextBlock Classes="h3" Text="线圈" />
                                <TextBlock Classes="Muted" Text="读写线圈 (功能码 01/05)" />
                            </StackPanel>
                        </shadui:Card.Header>
                        <shadui:Card.Content>
                            <StackPanel Spacing="16">
                                <!-- 读取线圈 -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto" RowDefinitions="Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="起始地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding CoilReadAddress}" Watermark="0" />
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="数量" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding CoilReadCount}" Watermark="10" />
                                    <Button Grid.Row="0" Grid.Column="4" Content="读取" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding ReadCoilsCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="结果" VerticalAlignment="Center" Margin="0,8,8,0" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" 
                                             Text="{Binding CoilReadResult}" IsReadOnly="True" 
                                             Watermark="读取结果显示在这里 (True/False)..." Margin="0,8,0,0" />
                                </Grid>

                                <Border Height="1" Background="{DynamicResource BorderBrush}" />

                                <!-- 写入线圈 -->
                                <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                                    <TextBlock Grid.Column="0" Text="地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Column="1" Text="{Binding CoilWriteAddress}" Watermark="0" />
                                    <TextBlock Grid.Column="2" Text="值" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <ToggleSwitch Grid.Column="3" IsChecked="{Binding CoilWriteValue}" 
                                                  OnContent="ON" OffContent="OFF" />
                                    <Button Grid.Column="4" Content="写入" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding WriteSingleCoilCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                </Grid>
                            </StackPanel>
                        </shadui:Card.Content>
                    </shadui:Card>
                </StackPanel>
            </TabItem>

            <!-- Float Tab -->
            <TabItem Header="Float">
                <StackPanel Spacing="16" Margin="0,16,0,0">
                    <shadui:Card>
                        <shadui:Card.Header>
                            <StackPanel Spacing="4">
                                <TextBlock Classes="h3" Text="Float 读写" />
                                <TextBlock Classes="Muted" Text="32位浮点数 (占用2个寄存器)" />
                            </StackPanel>
                        </shadui:Card.Header>
                        <shadui:Card.Content>
                            <StackPanel Spacing="16">
                                <!-- 读取 Float -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto" RowDefinitions="Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="起始地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding FloatReadAddress}" Watermark="0" />
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="数量" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding FloatReadCount}" Watermark="1" />
                                    <Button Grid.Row="0" Grid.Column="4" Content="读取" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding ReadFloatCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="结果" VerticalAlignment="Center" Margin="0,8,8,0" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" 
                                             Text="{Binding FloatReadResult}" IsReadOnly="True" 
                                             Watermark="读取结果显示在这里..." Margin="0,8,0,0" />
                                </Grid>

                                <Border Height="1" Background="{DynamicResource BorderBrush}" />

                                <!-- 写入 Float -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto">
                                    <TextBlock Grid.Column="0" Text="地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Column="1" Text="{Binding FloatWriteAddress}" Watermark="0" />
                                    <TextBlock Grid.Column="2" Text="值" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Column="3" Text="{Binding FloatWriteValue}" Watermark="0.0" />
                                    <Button Grid.Column="4" Content="写入" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding WriteFloatCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                </Grid>
                            </StackPanel>
                        </shadui:Card.Content>
                    </shadui:Card>
                </StackPanel>
            </TabItem>

            <!-- Double Tab -->
            <TabItem Header="Double">
                <StackPanel Spacing="16" Margin="0,16,0,0">
                    <shadui:Card>
                        <shadui:Card.Header>
                            <StackPanel Spacing="4">
                                <TextBlock Classes="h3" Text="Double 读写" />
                                <TextBlock Classes="Muted" Text="64位双精度浮点数 (占用4个寄存器)" />
                            </StackPanel>
                        </shadui:Card.Header>
                        <shadui:Card.Content>
                            <StackPanel Spacing="16">
                                <!-- 读取 Double -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto" RowDefinitions="Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="起始地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding DoubleReadAddress}" Watermark="0" />
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="数量" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding DoubleReadCount}" Watermark="1" />
                                    <Button Grid.Row="0" Grid.Column="4" Content="读取" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding ReadDoubleCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="结果" VerticalAlignment="Center" Margin="0,8,8,0" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" 
                                             Text="{Binding DoubleReadResult}" IsReadOnly="True" 
                                             Watermark="读取结果显示在这里..." Margin="0,8,0,0" />
                                </Grid>

                                <Border Height="1" Background="{DynamicResource BorderBrush}" />

                                <!-- 写入 Double -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto">
                                    <TextBlock Grid.Column="0" Text="地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Column="1" Text="{Binding DoubleWriteAddress}" Watermark="0" />
                                    <TextBlock Grid.Column="2" Text="值" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Column="3" Text="{Binding DoubleWriteValue}" Watermark="0.0" />
                                    <Button Grid.Column="4" Content="写入" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding WriteDoubleCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                </Grid>
                            </StackPanel>
                        </shadui:Card.Content>
                    </shadui:Card>
                </StackPanel>
            </TabItem>

            <!-- Boolean Tab -->
            <TabItem Header="Boolean">
                <StackPanel Spacing="16" Margin="0,16,0,0">
                    <shadui:Card>
                        <shadui:Card.Header>
                            <StackPanel Spacing="4">
                                <TextBlock Classes="h3" Text="Boolean 读写" />
                                <TextBlock Classes="Muted" Text="布尔值 (保持寄存器，0=false, 非0=true)" />
                            </StackPanel>
                        </shadui:Card.Header>
                        <shadui:Card.Content>
                            <StackPanel Spacing="16">
                                <StackPanel Spacing="20" Orientation="Horizontal">
                                    <TextBlock Margin="0,0,8,0">轮询寄存器 4000 结果：</TextBlock>
                                    <TextBlock Text="{Binding PollyHeart}"/>
                                </StackPanel>

                                <!-- 读取 Boolean -->
                                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto" RowDefinitions="Auto,Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="起始地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding BoolReadAddress}" Watermark="0" />
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="数量" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding BoolReadCount}" Watermark="1" />
                                    <Button Grid.Row="0" Grid.Column="4" Content="读取" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding ReadBooleanCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="结果" VerticalAlignment="Center" Margin="0,8,8,0" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" 
                                             Text="{Binding BoolReadResult}" IsReadOnly="True" 
                                             Watermark="读取结果显示在这里 (True/False)..." Margin="0,8,0,0" />
                                </Grid>

                                <Border Height="1" Background="{DynamicResource BorderBrush}" />

                                <!-- 写入 Boolean -->
                                <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                                    <TextBlock Grid.Column="0" Text="地址" VerticalAlignment="Center" Margin="0,0,8,0" />
                                    <TextBox Grid.Column="1" Text="{Binding BoolWriteAddress}" Watermark="0" />
                                    <TextBlock Grid.Column="2" Text="值" VerticalAlignment="Center" Margin="16,0,8,0" />
                                    <ToggleSwitch Grid.Column="3" IsChecked="{Binding BoolWriteValue}" 
                                                  OnContent="True" OffContent="False" />
                                    <Button Grid.Column="4" Content="写入" Classes="Primary" Margin="16,0,0,0"
                                            Command="{Binding WriteBooleanCommand}" 
                                            IsEnabled="{Binding IsMasterConnected}" />
                                </Grid>
                            </StackPanel>
                        </shadui:Card.Content>
                    </shadui:Card>
                </StackPanel>
            </TabItem>
        </TabControl>
    </StackPanel>
</UserControl>
