<UserControl
    x:Class="EModbus.Views.SlaveView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:shadui="clr-namespace:ShadUI;assembly=ShadUI"
    xmlns:vm="clr-namespace:EModbus.ViewModels"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:DataType="vm:SlaveViewModel"
    mc:Ignorable="d">
    <StackPanel Spacing="16" Margin="0,16,0,0">
        <!-- 状态卡片 -->
        <shadui:Card>
            <shadui:Card.Header>
                <StackPanel Spacing="4">
                    <TextBlock Classes="h3" Text="从站状态" />
                    <TextBlock Classes="Muted" Text="Modbus TCP 从站模拟器" />
                </StackPanel>
            </shadui:Card.Header>
            <shadui:Card.Content>
                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" Margin="0,8,0,0">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="监听地址" VerticalAlignment="Center" />
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SlaveSettings.IpAddress}" Classes="Muted" />

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="端口号" VerticalAlignment="Center" Margin="0,8,0,0" />
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SlaveSettings.Port}" Classes="Muted" Margin="0,8,0,0" />

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="从站ID" VerticalAlignment="Center" Margin="0,8,0,0" />
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SlaveSettings.SlaveId}" Classes="Muted" Margin="0,8,0,0" />

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="运行状态" VerticalAlignment="Center" Margin="0,8,0,0" />
                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SlaveStatus}" 
                               Classes.Success="{Binding IsSlaveRunning}"
                               Classes.Muted="{Binding !IsSlaveRunning}"
                               Margin="0,8,0,0" />
                </Grid>
            </shadui:Card.Content>
            <shadui:Card.Footer>
                <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right">
                    <Button Content="启动从站" Classes="Primary" 
                            Command="{Binding StartSlaveCommand}" 
                            IsEnabled="{Binding !IsSlaveRunning}" />
                    <Button Content="停止从站" Classes="Destructive" 
                            Command="{Binding StopSlaveCommand}" 
                            IsEnabled="{Binding IsSlaveRunning}" />
                </StackPanel>
            </shadui:Card.Footer>
        </shadui:Card>

        <!-- 寄存器编辑卡片 -->
        <shadui:Card>
            <shadui:Card.Header>
                <Grid ColumnDefinitions="*,Auto">
                    <StackPanel Grid.Column="0" Spacing="4">
                        <TextBlock Classes="h3" Text="保持寄存器" />
                        <TextBlock Classes="Muted" Text="双击值列可编辑，修改后实时同步到从站" />
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="数量:" VerticalAlignment="Center" />
                        <TextBox Text="{Binding RegisterCount}" Width="60" />
                        <Button Content="重置" Classes="Outline" Command="{Binding RefreshRegistersCommand}" />
                        <Button Content="同步" Classes="Outline" Command="{Binding SyncFromSlaveCommand}" 
                                IsEnabled="{Binding IsSlaveRunning}" />
                    </StackPanel>
                </Grid>
            </shadui:Card.Header>
            <shadui:Card.Content>
                <DataGrid ItemsSource="{Binding HoldingRegisters}" 
                          Height="400"
                          AutoGenerateColumns="False"
                          CanUserReorderColumns="False"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          GridLinesVisibility="Horizontal"
                          IsReadOnly="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="地址" Binding="{Binding Address}" IsReadOnly="True" Width="80" />
                        <DataGridTextColumn Header="值" Binding="{Binding Value}" Width="100" />
                        <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </shadui:Card.Content>
        </shadui:Card>

        <!-- 线圈编辑卡片 -->
        <shadui:Card>
            <shadui:Card.Header>
                <StackPanel Spacing="4">
                    <TextBlock Classes="h3" Text="线圈" />
                    <TextBlock Classes="Muted" Text="点击复选框可切换状态" />
                </StackPanel>
            </shadui:Card.Header>
            <shadui:Card.Content>
                <DataGrid ItemsSource="{Binding Coils}" 
                          Height="400"
                          AutoGenerateColumns="False"
                          CanUserReorderColumns="False"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          GridLinesVisibility="Horizontal"
                          IsReadOnly="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="地址" Binding="{Binding Address}" IsReadOnly="True" Width="80" />
                        <DataGridCheckBoxColumn Header="值" Binding="{Binding Value}" Width="80" />
                        <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </shadui:Card.Content>
        </shadui:Card>        
    </StackPanel>
</UserControl>
